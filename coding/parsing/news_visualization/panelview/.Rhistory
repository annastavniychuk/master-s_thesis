#cex.axis.y=12, cex.axis.x=7,
cex.axis=12,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
mycol<-brewer.pal(4,"Set2")[c(1,2,3,4)]
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
#cex.lab = 14,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=12,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
mycol<-brewer.pal(4,"Set3")[c(1,2,3,4)]
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
#cex.lab = 14,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=12,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
#background = 'white',
#cex.lab = 14,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=12,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
#cex.lab = 14,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=12,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
setwd("~/Documents/master's_thesis/coding/parsing/news_visualization/panelview")
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
#cex.lab = 14,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=18,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 14,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=18,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 18,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=18,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 18,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=18,
cex.legend = 18,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 18,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=18,
cex.legend = 18,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 20,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=20,
cex.legend = 20,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 20,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=20,
cex.legend = 20,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
# Импортируем данные и меняем формат дат
# data <- read_csv("finam/news_filtered.csv")
# data <- fread("~/Documents/master's_thesis/coding/parsing/finam/news_dummy_filter.csv", header=T)
data <- read.csv("~/Documents/master's_thesis/coding/parsing/finam/news_dummy_filter_upd.csv")
data <- data %>% filter(FAS == 1)
data <- data %>% filter(event_predupr == 1 | event_predost == 1 | event_delo == 1 | event_resh_predp == 1)
data$preview_date <- as.Date(data$preview_date, format = "%d.%m.%Y")
# русифицируем название компаний для подписи осей
data1 <- data %>% mutate(company_rus=case_when(company == "rosneft" ~ 1,
company =="bashneft-ank-ao" ~ 2,
company == "gazprom-neft" ~ 3,
company == "lukoil" ~ 4,
company == "tatneft-3" ~ 5,
TRUE ~ 0))
data1$company_rus[data1$company_rus==1] <- 'Роснефть'
data1$company_rus[data1$company_rus==2] <- 'Башнефть'
data1$company_rus[data1$company_rus==3] <- 'Газпромнефть'
data1$company_rus[data1$company_rus==4] <- 'Лукойл'
data1$company_rus[data1$company_rus==5] <- 'Татнефть'
# конвертируем one hot encoding to label encoding
data1 <- data1 %>% mutate(event=case_when(event_delo == TRUE ~ 1,
event_predost == TRUE ~ 2,
#event_predp == TRUE ~ 3,
#event_resh == TRUE ~ 4,
event_resh_predp == TRUE ~ 3,
event_predupr == TRUE ~ 4,
TRUE ~ 0))
data1$X1 <- c(1:nrow(data1))
# рисуем графичек
library(RColorBrewer)
mycol<-brewer.pal(4,"Set3")[c(1,2,3,4)]
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 20,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=20,
cex.legend = 20,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 25,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=25,
cex.legend = 25,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 30,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=30,
cex.legend = 30,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 25,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=30,
cex.legend = 30,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
mycol<-brewer.pal(4,"Set3")[c(1,2,3,4)]
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 25,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=30,
cex.legend = 30,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
graph <- panelView(X1 ~ event, data = data1,
index = c("company_rus", "preview_date"),
by.timing = TRUE,
legend.labs = c("Дело", "Предостережение", "Решение и предписание", "Предупреждение"),
#main = "События с Финам.ру",
main = "",
background = 'white',
cex.lab = 30,
#cex.axis.y=12, cex.axis.x=7,
cex.axis=25,
cex.legend = 30,
color = mycol,
#axis.lab.gap = c(1,0),
xlab="Дата", ylab="Компания")
graph
graph1 <- graph + theme(axis.text.x = element_text(angle = 90))
graph1
cairo_pdf(file = 'event_panelview_upd.pdf', width = 21, height = 12)
graph1
dev.off()
# Пакеты
{
library(readxl)
library(dplyr)
library(stringr)
library(data.table)
}
# Импорт данных
{
# ЦДУ
cdu <- read_excel("~/Documents/master's_thesis/coding/data/petrol/cdu/AZS_2012-2019.xlsx")
# ФАС
ai_95 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_95.xlsx")
ai_92_93 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_92_93.xlsx")
ai_76_80 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_76_80.xlsx")
# События
news <- read.csv("~/Documents/master's_thesis/coding/parsing/finam/news_filtered.csv")
}
# склеиваем отдельные датасеты с ценами
{
fas <- rbind(ai_95, ai_92_93)
fas <- rbind(fas, ai_76_80)
}
# правим дату в нужный формат
{
fas$Дата <- as.POSIXlt(fas$Дата, format="%m/%d/%Y")
news$article_date <- as.Date(news$article_date, format ="%d.%m.%Y")
}
# приводим название компаний в одинаковый вид
{
news$company <- str_replace(news$company, "rosneft", "ОАО 'НК 'Роснефть'")
news$company <- str_replace(news$company, "bashneft-ank-ao", "ОАО АНК 'Башнефть'")
news$company <- str_replace(news$company, "gazprom-neft", "ОАО 'Газпром нефть'")
news$company <- str_replace(news$company, "lukoil", "ОАО 'Лукойл'")
news$company <- str_replace(news$company, "tatneft-3", "ОАО 'Татнефть'")
}
colnames(news)[8] <- 'Дата'
# добавляем к ценам данные о новостях
fas <- left_join(fas, news, by = c('Дата'))
View(news)
View(fas)
View(news)
colnames(news)[6] <- 'Винк'
colnames(news)[8] <- 'Дата'
# добавляем к ценам данные о новостях
fas <- left_join(fas, news, by = c('Дата', 'Винк'))
View(fas)
# Импорт данных
{
# ЦДУ
cdu <- read_excel("~/Documents/master's_thesis/coding/data/petrol/cdu/AZS_2012-2019.xlsx")
# ФАС
ai_95 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_95.xlsx")
ai_92_93 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_92_93.xlsx")
ai_76_80 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_76_80.xlsx")
# События
news <- read.csv("~/Documents/master's_thesis/coding/parsing/finam/news_filtered.csv")
}
# Обработка данных ФАС
{
# склеиваем отдельные датасеты с ценами
{
fas <- rbind(ai_95, ai_92_93)
fas <- rbind(fas, ai_76_80)
}
# правим дату в нужный формат
{
fas$Дата <- as.POSIXlt(fas$Дата, format="%m/%d/%Y")
news$article_date <- as.Date(news$article_date, format ="%d.%m.%Y")
}
#unique(fas[c("Винк")])
#unique(news[c("company")])
# приводим название компаний в одинаковый вид
{
news$company <- str_replace(news$company, "rosneft", "ОАО 'НК 'Роснефть'")
news$company <- str_replace(news$company, "bashneft-ank-ao", "ОАО АНК 'Башнефть'")
news$company <- str_replace(news$company, "gazprom-neft", "ОАО 'Газпром нефть'")
news$company <- str_replace(news$company, "lukoil", "ОАО 'Лукойл'")
news$company <- str_replace(news$company, "tatneft-3", "ОАО 'Татнефть'")
}
colnames(news)[6] <- 'Винк'
colnames(news)[8] <- 'Дата'
# добавляем к ценам данные о новостях
fas <- left_join(fas, news, by = c('Дата', 'Винк'))
# Импорт данных
{
# ЦДУ
cdu <- read_excel("~/Documents/master's_thesis/coding/data/petrol/cdu/AZS_2012-2019.xlsx")
# ФАС
ai_95 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_95.xlsx")
ai_92_93 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_92_93.xlsx")
ai_76_80 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_76_80.xlsx")
# События
news <- read.csv("~/Documents/master's_thesis/coding/parsing/finam/news_filtered.csv")
}
# Обработка данных ФАС
{
# склеиваем отдельные датасеты с ценами
{
fas <- rbind(ai_95, ai_92_93)
fas <- rbind(fas, ai_76_80)
}
# правим дату в нужный формат
{
fas$Дата <- as.POSIXlt(fas$Дата, format="%m/%d/%Y")
news$article_date <- as.Date(news$article_date, format ="%d.%m.%Y")
}
#unique(fas[c("Винк")])
#unique(news[c("company")])
# приводим название компаний в одинаковый вид
{
news$company <- str_replace(news$company, "rosneft", "ОАО 'НК 'Роснефть'")
news$company <- str_replace(news$company, "bashneft-ank-ao", "ОАО АНК 'Башнефть'")
news$company <- str_replace(news$company, "gazprom-neft", "ОАО 'Газпром нефть'")
news$company <- str_replace(news$company, "lukoil", "ОАО 'Лукойл'")
news$company <- str_replace(news$company, "tatneft-3", "ОАО 'Татнефть'")
}
colnames(news)[6] <- 'Винк'
colnames(news)[8] <- 'Дата'
# добавляем к ценам данные о новостях
fas <- left_join(fas, news, by = c('Дата', 'Винк'))
# fas$treatment <- as.factor(ifelse(fas$event_predupr == TRUE, '1',
#                             ifelse(fas$event_predost == TRUE, '2',
#                             ifelse(fas$event_delo == TRUE, '3',
#                             ifelse(fas$event_resh == TRUE, '4',
#                             ifelse(fas$event_predp == TRUE, '5', NA))))))
# контроль или тритмент группа
{
fas$treatment <- fas$Винк==fas$company
fas$treatment<-replace(fas$treatment, is.na(fas$treatment), 0)
}
# Подчищаем технические хвосты -- форматы данных и тд
{
fas <- fas[,-c(1,8,9,10,11,12,17)]
fas$Cредняя_Розничная_цена <- as.numeric(fas$Cредняя_Розничная_цена)
fas$event_predupr <- as.numeric(as.logical(fas$event_predupr))
fas$event_predost <- as.numeric(as.logical(fas$event_predost))
fas$event_delo <- as.numeric(as.logical(fas$event_delo))
fas$event_resh <- as.numeric(as.logical(fas$event_resh))
fas$event_predp <- as.numeric(as.logical(fas$event_predp))
fas$event_predupr<-replace(fas$event_predupr, is.na(fas$event_predupr), 0)
fas$event_predost<-replace(fas$event_predost, is.na(fas$event_predost), 0)
fas$event_delo<-replace(fas$event_delo, is.na(fas$event_delo), 0)
fas$event_resh<-replace(fas$event_resh, is.na(fas$event_resh), 0)
fas$event_predp<-replace(fas$event_predp, is.na(fas$event_predp), 0)
}
}
# Импорт данных
{
# ЦДУ
cdu <- read_excel("~/Documents/master's_thesis/coding/data/petrol/cdu/AZS_2012-2019.xlsx")
# ФАС
ai_95 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_95.xlsx")
ai_92_93 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_92_93.xlsx")
ai_76_80 <- read_excel("~/Documents/master's_thesis/coding/data/petrol/fas/ai_76_80.xlsx")
# События
news <- read.csv("~/Documents/master's_thesis/coding/parsing/finam/news_filtered.csv")
}
